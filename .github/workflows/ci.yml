# ðŸ“„ CI Pipeline Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° Ð¸ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ ÐºÐ¾Ð´Ð°

name: CI

# ðŸ” Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð»ÑŽÐ±Ð¾Ð¼ Ð¿ÑƒÑˆÐµ Ð¸Ð»Ð¸ pull request Ð² Ð»ÑŽÐ±Ð¾Ð¹ Ð²ÐµÑ‚ÐºÐµ
on: [push, pull_request]

jobs:
  build-and-test:
    name: ðŸ§ª Lint, Test, Typecheck, Build
    runs-on: ubuntu-latest

    steps:
      # âœ… ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÐ¼ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
      - name: ðŸ“¥ Checkout repo
        uses: actions/checkout@v4

      # âœ… Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Node.js Ð½ÑƒÐ¶Ð½Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
      - name: ðŸ”§ Use Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      # âœ… Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· `npm ci` (Ñ‡Ð¸ÑÑ‚Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð¾ lock-Ñ„Ð°Ð¹Ð»Ñƒ)
      - name: ðŸ“¦ Install dependencies
        run: npm ci

      # âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð»Ð¸Ð½Ñ‚Ð¸Ð½Ð³ Ð²ÑÐµÐ³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
      - name: ðŸ” Run ESLint
        run: npm run lint

      # âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (ÐµÑÐ»Ð¸ ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ð¾Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð»)
      - name: ðŸ§¼ Run Prettier check
        run: npx prettier --check .

      # âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð² TypeScript
      - name: ðŸ§  Typecheck
        run: npx tsc --noEmit

      # âœ… ÐŸÑ€Ð¾Ð³Ð¾Ð½ unit-Ñ‚ÐµÑÑ‚Ð¾Ð² Ñ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸ÐµÐ¼
      - name: ðŸ§ª Run Tests with Jest
        run: npm run test -- --coverage

      # âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ÑÑ
      - name: ðŸ— Build Vite project
        run: npm run build

      # âœ… (Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾) Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ commit ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ â€” Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ push
      - name: âœ… Check commit messages (commitlint)
        if: github.event_name == 'push'
        run: |
          git log -1 --pretty=format:%s > commit-msg.txt
          npx commitlint --edit commit-msg.txt
